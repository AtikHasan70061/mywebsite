<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Editable Student Profile - Green Valley High School</title>
<style>
  :root{--green:#2e7d32;--accent:#1565c0;}
  body{font-family:Inter,Segoe UI,Arial; background:linear-gradient(180deg,#f6fbfb,#ffffff); margin:0; padding:22px;}
  header{background:var(--green); color:#fff; padding:16px; border-radius:10px; text-align:center; margin-bottom:18px;}
  .container{max-width:1000px; margin:0 auto; display:grid; grid-template-columns:360px 1fr; gap:18px;}
  .card{background:#fff; padding:16px; border-radius:10px; box-shadow:0 8px 28px rgba(0,0,0,0.06);}
  .profile-pic{width:100%; height:200px; object-fit:cover; border-radius:8px; background:linear-gradient(135deg,#dfe9ff,#ffffff); display:flex; align-items:center; justify-content:center; color:#555; font-weight:700;}
  h3{margin:6px 0 12px 0;}
  .info-row{font-size:14px; color:#333; margin:8px 0; display:flex; justify-content:space-between; align-items:center;}
  .info-row input{width:60%; padding:6px; border-radius:6px; border:1px solid #ccc;}
  .label{color:#666; width:35%;}
  .badge{display:inline-block;padding:6px 10px;border-radius:8px;background:#e8f5e9;color:var(--green); font-weight:700;}
  .section-title{font-weight:800; margin-bottom:8px; color:#143642;}
  .subjects {margin-top:8px;}
  .subject-item{display:flex; align-items:center; justify-content:space-between; margin:6px 0;}
  .subject-bar{width:60%; background:#eee; border-radius:8px; overflow:hidden; height:18px; margin-left:8px;}
  .subject-fill{height:100%; text-align:right; padding-right:6px; color:#fff; font-size:12px;}
  .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700;}
  .btn.primary{background:var(--green); color:#fff;}
  .btn.warn{background:#f57c00;color:#fff;}
  .btn.ghost{background:#f1f1f1;color:#333;}

  .activities textarea{width:100%; min-height:90px; border-radius:8px; border:1px solid #ddd; padding:8px; font-size:14px;}
  .flex{display:flex; gap:10px; align-items:center;}
  .rightActions{display:flex; gap:8px; justify-content:flex-end;}
  .msg{margin-top:10px; font-weight:700; color:green;}
  input[type="file"]{margin-top:8px;}
  @media(max-width:960px){ .container{grid-template-columns:1fr;} }
</style>
</head>
<body>
<header>
  <h1>Green Valley High School</h1>
  <div style="font-size:14px;color:#e6f6ee">Editable Student Profile</div>
</header>

<div class="container">
  <!-- Left: Profile summary -->
  <div class="card">
    <div class="profile-pic" id="profPic">Student Photo</div>
    <input type="file" id="profPicUpload" onchange="uploadPic(event)">
    <h3 id="stuName">Student Name</h3>
    <div class="info-row"><div class="label">ID</div><div id="stuId">-</div></div>
    <div class="info-row"><div class="label">Class / Section / Roll</div><div id="stuCls">-</div></div>
    <div class="info-row"><div class="label">Attendance</div><div id="stuAttend">-</div></div>
    <div style="margin-top:10px;" class="flex">
      <button class="btn primary" onclick="goToResults()">View Detailed Result</button>
      <button class="btn ghost" onclick="logout()">Logout</button>
    </div>
    <hr style="margin:12px 0"/>
    <div>
      <div class="section-title">Change Password</div>
      <input id="currentPass" type="password" placeholder="Current password">
      <input id="newPass1" type="password" placeholder="New password" style="margin-top:6px;">
      <input id="newPass2" type="password" placeholder="Confirm new password" style="margin-top:6px;">
      <div class="flex" style="margin-top:6px;">
        <button class="btn warn" onclick="changePassword()">Change Password</button>
        <div id="pwMsg"></div>
      </div>
    </div>
  </div>

  <!-- Right: Editable details & marks -->
  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        <div class="section-title">Profile Details</div>
      </div>
      <div class="rightActions">
        <button class="btn ghost" onclick="printProfile()">Print</button>
        <button class="btn primary" onclick="saveProfile()">Save Changes</button>
      </div>
    </div>

    <div style="margin-top:8px;">
      <div class="info-row"><div class="label">Full Name</div><input id="infoName"></div>
      <div class="info-row"><div class="label">Email</div><input id="infoEmail"></div>
      <div class="info-row"><div class="label">Contact</div><input id="infoContact"></div>
      <div class="info-row"><div class="label">Guardian Contact</div><input id="infoGuardianContact"></div>
      <div class="info-row"><div class="label">Address</div><input id="infoAddress"></div>
      <div class="info-row"><div class="label">City</div><input id="infoCity"></div>
      <div class="info-row"><div class="label">Postal Code</div><input id="infoPostal"></div>
      <div class="info-row"><div class="label">Parent Name</div><input id="infoParent"></div>
      <div class="info-row"><div class="label">Section Teacher</div><input id="infoTeacher"></div>
      <div class="info-row"><div class="label">House</div><input id="infoHouse"></div>
      <div class="info-row"><div class="label">Birthdate</div><input id="infoDOB" type="date"></div>
    </div>

    <hr style="margin:12px 0"/>
    <div class="section-title">Latest Marks (Selected Year/Semester)</div>
    <div style="display:flex; gap:14px; margin-top:8px;">
      <div style="flex:1;"><label>Year</label>
        <select id="viewYear" onchange="renderMarksView()"><option>2025</option><option>2024</option><option>2023</option><option>2022</option></select>
      </div>
      <div style="width:140px;"><label>Semester</label>
        <select id="viewSem" onchange="renderMarksView()"><option value="1">1st</option><option value="2">2nd</option></select>
      </div>
    </div>
    <div id="marksArea" class="subjects"></div>
    <div id="marksSummary" style="margin-top:8px;font-weight:700;"></div>

    <hr style="margin:12px 0"/>
    <div class="section-title">Extracurricular Activities</div>
    <div class="activities">
      <textarea id="activitiesInput" placeholder="List activities..."></textarea>
    </div>
    <div id="saveMsg" class="msg"></div>
  </div>
</div>

<script>
function loadStudents(){ return JSON.parse(localStorage.getItem('studentsData')||'[]'); }
function saveStudents(arr){ localStorage.setItem('studentsData', JSON.stringify(arr)); }

/* ===== Seed ===== */
(function ensureSeed(){
  if(localStorage.getItem('studentsData')) return;
  const students=[];
  const classes=[1,2,3,4,5,6,7,8,9,10]; const sections=['A','B','C'];
  classes.forEach(cls=>{sections.forEach(sec=>{for(let r=1;r<=50;r++){
    const marksObj={}; const subs=(cls<=5)?["Math","English","Bangla","Science","ICT","Arts","Sports"]:["Math","English","Bangla","Physics","Chemistry","Biology","ICT","History","Geography","Economics","Arts","Sports","Religion","Social Science"];
    subs.forEach(s=>marksObj[s]=Math.floor(Math.random()*41)+60);
    students.push({name:`Student_${cls}${sec}${String(r).padStart(2,'0')}`,class:String(cls),section:sec,roll:String(r),id:`C${cls}${sec}${String(r).padStart(3,'0')}`,marks:{"2025":{"1":marksObj}},presentDays:Math.floor(Math.random()*11)+110,password:"12345",activities:["No activities recorded"],contact:"",email:"",guardianContact:"",address:"",city:"",postalCode:"",parentName:"",sectionTeacher:"",house:"",dob:"",photo:""});
  }})});
  localStorage.setItem('studentsData',JSON.stringify(students));
})();

/* ===== Session ===== */
if(sessionStorage.getItem('isStudentLogged')!=='1'){alert('Please login first.');window.location.href='studentlogin.html';}
const cls=sessionStorage.getItem('loggedStudentClass');
const sec=sessionStorage.getItem('loggedStudentSection');
const roll=sessionStorage.getItem('loggedStudentRoll');

let students=loadStudents();
let student=students.find(s=>s.class==cls && s.section==sec && s.roll==roll);
if(!student){alert('Student not found');window.location.href='studentlogin.html';}

function loadProfile(){
  document.getElementById('stuName').textContent=student.name;
  document.getElementById('stuId').textContent=student.id;
  document.getElementById('stuCls').textContent=`Class ${student.class} - ${student.section} (Roll ${student.roll})`;
  document.getElementById('stuAttend').textContent=`${student.presentDays}/120 days`;
  document.getElementById('infoName').value=student.name||'';
  document.getElementById('infoEmail').value=student.email||'';
  document.getElementById('infoContact').value=student.contact||'';
  document.getElementById('infoGuardianContact').value=student.guardianContact||'';
  document.getElementById('infoAddress').value=student.address||'';
  document.getElementById('infoCity').value=student.city||'';
  document.getElementById('infoPostal').value=student.postalCode||'';
  document.getElementById('infoParent').value=student.parentName||'';
  document.getElementById('infoTeacher').value=student.sectionTeacher||'';
  document.getElementById('infoHouse').value=student.house||'';
  document.getElementById('infoDOB').value=student.dob||'';
  document.getElementById('activitiesInput').value=Array.isArray(student.activities)?student.activities.join("\n"):'';
  if(student.photo) document.getElementById('profPic').style.backgroundImage=`url(${student.photo})`; 
}
loadProfile();

function saveProfile(){
  student.name=document.getElementById('infoName').value.trim();
  student.email=document.getElementById('infoEmail').value.trim();
  student.contact=document.getElementById('infoContact').value.trim();
  student.guardianContact=document.getElementById('infoGuardianContact').value.trim();
  student.address=document.getElementById('infoAddress').value.trim();
  student.city=document.getElementById('infoCity').value.trim();
  student.postalCode=document.getElementById('infoPostal').value.trim();
  student.parentName=document.getElementById('infoParent').value.trim();
  student.sectionTeacher=document.getElementById('infoTeacher').value.trim();
  student.house=document.getElementById('infoHouse').value.trim();
  student.dob=document.getElementById('infoDOB').value;
  student.activities=document.getElementById('activitiesInput').value.split('\n').map(s=>s.trim()).filter(Boolean);
  students=students.map(s=>(s.class==student.class && s.section==student.section && s.roll==student.roll)?student:s);
  saveStudents(students);
  document.getElementById('saveMsg').textContent="Profile saved!";
  setTimeout(()=>document.getElementById('saveMsg').textContent='',1500);
  loadProfile();
}

function renderMarksView(){
  const year=document.getElementById('viewYear').value||"2025";
  const sem=document.getElementById('viewSem').value||"1";
  const marksArea=document.getElementById('marksArea');marksArea.innerHTML='';
  const summary=document.getElementById('marksSummary');summary.textContent='';
  if(!student.marks||!student.marks[year]||!student.marks[year][sem]){marksArea.innerHTML='<div style="color:#c62828;font-weight:700">No marks found</div>';return;}
  const marks=student.marks[year][sem];let total=0,count=0;
  for(const sub in marks){const val=marks[sub];total+=val;count++;const color=(val>=80)?'#2e7d32':(val>=60)?'#f57c00':'#c62828';const fill=`<div class="subject-fill" style="width:${val}%;background:${color}">${val}</div>`;marksArea.insertAdjacentHTML('beforeend',`<div class="subject-item"><div style="width:35%">${sub}</div><div class="subject-bar">${fill}</div></div>`);}
  summary.textContent=`Total: ${total} / ${count*100}  —  Percentage: ${((total/(count*100))*100).toFixed(2)}%`;
}
renderMarksView();

function changePassword(){
  const cur=document.getElementById('currentPass').value,n1=document.getElementById('newPass1').value,n2=document.getElementById('newPass2').value;
  const pm=document.getElementById('pwMsg');pm.textContent='';
  if(!cur||!n1||!n2){pm.textContent="Fill all fields";pm.style.color='red';return;}
  if(cur!==student.password){pm.textContent="Current password incorrect";pm.style.color='red';return;}
  if(n1.length<4){pm.textContent="New password min 4 chars";pm.style.color='red';return;}
  if(n1!==n2){pm.textContent="New password mismatch";pm.style.color='red';return;}
  student.password=n1;
  students=students.map(s=>(s.class==student.class && s.section==student.section && s.roll==student.roll)?student:s);
  saveStudents(students);
  pm.textContent="Password changed successfully";pm.style.color='green';
  document.getElementById('currentPass').value='';document.getElementById('newPass1').value='';document.getElementById('newPass2').value='';
}

function uploadPic(e){
  const reader=new FileReader();
  reader.onload=function(){document.getElementById('profPic').style.backgroundImage=`url(${reader.result})`;student.photo=reader.result;students=students.map(s=>(s.class==student.class && s.section==student.section && s.roll==student.roll)?student:s);saveStudents(students);}
  reader.readAsDataURL(e.target.files[0]);
}

function goToResults(){sessionStorage.setItem('studentResultClass',student.class);sessionStorage.setItem('studentResultSection',student.section);sessionStorage.setItem('studentResultRoll',student.roll);sessionStorage.setItem('studentResultYear',document.getElementById('viewYear').value||'2025');sessionStorage.setItem('studentResultSem',document.getElementById('viewSem').value||'1');window.open('studentresult.html','_blank');}
function printProfile(){const html=`<html><head><title>Profile - ${student.name}</title><style>body{font-family:Arial;padding:20px}</style></head><body><h2>${student.name}</h2><p><b>ID:</b>${student.id}</p><p><b>Class / Section / Roll:</b>${student.class} - ${student.section} - ${student.roll}</p><p><b>Attendance:</b>${student.presentDays}/120</p><h3>Details</h3><pre>${JSON.stringify(student,null,2)}</pre></body></html>`;const w=window.open('','', 'height=700,width=900');w.document.write(html);w.document.close();w.print();}
function logout(){sessionStorage.clear();window.location.href='studentlogin.html';}
</script>
</body>
</html>
