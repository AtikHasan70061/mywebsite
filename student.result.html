<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Result - Green Valley High School</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding:0;}
header { text-align:center; padding:15px; background:#4CAF50; color:white;}
.result-card { background:white; max-width:700px; margin:30px auto; padding:25px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.15);}
.result-card h2 { text-align:center; margin-bottom:10px; }
select, button { padding:8px 12px; font-size:16px; margin:5px 0;}
.student-info, .extra-info { display:flex; flex-direction:column; gap:8px; font-size:18px; margin-bottom:15px;}
.student-info p, .extra-info p { background:#e0f7fa; padding:8px; border-radius:6px; margin:0;}
.marks-section { display:flex; flex-direction:column; gap:10px; }
.subject-bar { display:flex; align-items:center; gap:10px; }
.subject-bar-name { width:120px; font-weight:bold; }
.subject-bar-value { flex:1; height:25px; border-radius:8px; background:#ccc; position:relative; }
.subject-bar-fill { height:100%; border-radius:8px; text-align:right; padding-right:5px; color:white; font-weight:bold; line-height:25px; }
.badge { text-align:center; font-size:20px; padding:8px 15px; border-radius:12px; color:white; margin-top:15px; display:inline-block; }
.print-btn { display:block; margin:20px auto 0 auto; padding:10px 25px; font-size:16px; background:#2196F3; color:white; border:none; border-radius:8px; cursor:pointer;}
.print-btn:hover { background:#0b7dda;}
@media(max-width:700px){
  .result-card { width:95%; padding:15px; }
  .subject-bar-name { width:90px; font-size:14px; }
  .subject-bar-fill { font-size:14px; padding-right:3px; }
}
</style>
</head>
<body>

<header>
  <h1>Green Valley High School</h1>
  <h2>Student Result</h2>
</header>

<div class="result-card">
  <div id="selector">
    <h3>Select Class, Section & Roll</h3>
    <label for="class">Class:</label>
    <select id="class">
      <option value="1">1</option><option value="2">2</option><option value="3">3</option>
      <option value="4">4</option><option value="5">5</option><option value="6">6</option>
      <option value="7">7</option><option value="8">8</option><option value="9">9</option>
      <option value="10">10</option>
    </select>

    <label for="section">Section:</label>
    <select id="section">
      <option value="A">A</option><option value="B">B</option><option value="C">C</option>
    </select>

    <label for="roll">Roll:</label>
    <input type="number" id="roll" placeholder="Enter Roll Number" min="1">

    <label for="year">Year:</label>
    <select id="year">
      <option value="2022">2022</option>
      <option value="2023">2023</option>
      <option value="2024">2024</option>
      <option value="2025" selected>2025</option>
    </select>

    <label for="semester">Semester:</label>
    <select id="semester">
      <option value="1">1st Semester</option>
      <option value="2">2nd Semester</option>
    </select>

    <button onclick="showResult()">View Result</button>
  </div>
</div>

<div id="resultGrid" class="result-card" style="display:none;"></div>

<script>
// Subjects based on class
function getSubjects(cls){
  if(cls<=5){
    return ["Math","English","Bangla","Science","ICT","Arts","Sports"];
  }else{
    return ["Math","English","Bangla","Physics","Chemistry","Biology","ICT","History","Geography","Economics","Arts","Sports","Religion","Social Science"];
  }
}

// Load students from localStorage
if(!localStorage.getItem("studentsData")){
  alert("No student data found! Please open Exam Controller first to generate students data.");
  var students = [];
}else{
  var students = JSON.parse(localStorage.getItem("studentsData"));
}

function getColor(mark){ if(mark>=80) return '#4CAF50'; else if(mark>=60) return '#FF9800'; else return '#F44336';}
function getBadge(percent){
  if(percent>=90) return `<span class="badge" style="background:#4CAF50;">Excellent üèÜ</span>`;
  else if(percent>=75) return `<span class="badge" style="background:#2196F3;">Very Good ‚≠ê</span>`;
  else if(percent>=60) return `<span class="badge" style="background:#FF9800;">Good üëç</span>`;
  else return `<span class="badge" style="background:#F44336;">Needs Improvement ‚ö†Ô∏è</span>`;
}

function showResult(){
  const cls = parseInt(document.getElementById('class').value);
  const sec = document.getElementById('section').value;
  const roll = parseInt(document.getElementById('roll').value);
  const year = document.getElementById('year').value;
  const semester = document.getElementById('semester').value;

  const student = students.find(s=>s.class==cls && s.section==sec && s.roll==roll);
  if(!student){ alert("Student not found!"); return; }

  let totalMarks = 0;
  let marksHTML = '';
  for(const [subject, mark] of Object.entries(student.marks)){
    totalMarks += mark;
    marksHTML += `
      <div class="subject-bar">
        <div class="subject-bar-name">${subject}</div>
        <div class="subject-bar-value">
          <div class="subject-bar-fill" style="width:${mark}%; background:${getColor(mark)};">${mark}/100</div>
        </div>
      </div>`;
  }

  const percentage = (totalMarks/Object.keys(student.marks).length).toFixed(2);

  const classSectionStudents = students.filter(s=>s.class==cls && s.section==sec);
  const topStudent = classSectionStudents.reduce((prev,curr)=>{
    const prevTotal = Object.values(prev.marks).reduce((a,b)=>a+b,0);
    const currTotal = Object.values(curr.marks).reduce((a,b)=>a+b,0);
    return (currTotal>prevTotal)?curr:prev;
  });
  const totalStudents = classSectionStudents.length;

  const resultGrid = document.getElementById('resultGrid');
  document.getElementById('selector').style.display='none';
  resultGrid.style.display='block';
  resultGrid.innerHTML = `
    <h2>${student.name} (Class ${student.class}-${student.section}, Roll ${student.roll})</h2>
    <div class="student-info">
      <p><strong>ID:</strong> ${student.id}</p>
      <p><strong>Year:</strong> ${year}</p>
      <p><strong>Semester:</strong> ${semester==1?'1st':'2nd'}</p>
      <p><strong>Semester Duration:</strong> Jan - Jun ${year}</p>
      <p><strong>Attendance:</strong> ${student.presentDays}/120 days</p>
    </div>

    <div class="extra-info">
      <p><strong>Total Students in Class-Section:</strong> ${totalStudents}</p>
      <p><strong>Top Student in Class-Section:</strong> ${topStudent.name} (Roll ${topStudent.roll})</p>
    </div>

    <h3 style="text-align:center;">Marks</h3>
    <div class="marks-section">
      ${marksHTML}
      <p><strong>Total:</strong> ${totalMarks}/${Object.keys(student.marks).length*100}</p>
      <p><strong>Percentage:</strong> ${percentage}%</p>
      ${getBadge(percentage)}
    </div>

    <button class="print-btn" onclick="window.print()">Print / Download Result</button>
  `;
}
</script>

</body>
</html>
